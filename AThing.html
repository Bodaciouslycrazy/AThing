<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>A Thing</title>
	
	<script type="text/javascript" src="howler.min.js"></script>
	<script type="text/javascript" src="Objects.js"></script>
	<script type="text/javascript" src="Gamestates.js"></script>
	<script type="text/javascript" src="RandomFunctions.js"></script>
	
</head>
<body>
<div class="wrapper">
	<div id="banner">
		<h1 id="title">A Thing</h1>
	</div>
	
	<canvas id='canvas' width='800' height='600'></canvas>
	
	<div class="push"></div>
</div>

	<div id="footer">
		<div class="container">
			<ul>
				<li>Created By: Bodie</li>
			</ul>
		</div>
	</div>
	
	<script type='text/javascript'>

	var can = document.getElementById('canvas');
	var ctx = can.getContext("2d");
	var lastTickTime = 0;
	var UPDATEINTERVAL = 1000 / 60;
	var accumulate = 0;
	
	var gamestate;
	var gamestates = {
		intro: new Intro(),
		mainRoom: new MainRoom(),
		room2: new Room2(),
		gameOver: new GameOver(),
		leftPath: new LeftPath(),
	};
	
	var player;
	
	var damageCounters = [];
	
	var keys = [];
	
	var images = {
		frame: new Image(),
		kim: new Image(),
		life: new Image(),
		weapons: new Image(),
		enemies: new Image(),
		room1: new Image(),
		room2: new Image(),
	};
	
	var music = {
		intro: 0,
	};
	
	//gamestates

	function tick(time){
		var deltaTime = time - lastTickTime;
		//console.log(deltaTime + "");
		
		ctx.clearRect(0,0,can.width,can.height);
		ctx.beginPath();//from what I know, this doesn't change anything, but clears all of the ctx.draw memory, keeping the process speed fast.
		gamestate.draw();
		drawDamageCounters();
		
		accumulate += deltaTime;
		
		while(accumulate >= UPDATEINTERVAL){
			gamestate.update(UPDATEINTERVAL);
			accumulate -= UPDATEINTERVAL;
			updateAllKeys();
			updateDamageCounters(UPDATEINTERVAL);
		}
		
		lastTickTime = time;
		window.requestAnimationFrame(tick);
	}
	
	function handleKeyDown(evt){
		
		for(i = 0; i < keys.length; i ++){
			if(evt.keyCode == keys[i].keyCode && keys[i].down != true)
				keys[i].press();
		}
		
		if(evt.keyCode > 32 && evt.keyCode < 87)
			evt.preventDefault();
	}
	
	function handleKeyUp(evt){
		
		for(i = 0; i < keys.length; i++){
			if(evt.keyCode == keys[i].keyCode)
				keys[i].release();
		}
		
		if(evt.keyCode > 32 && evt.keyCode < 87)
			evt.preventDefault();
	}
	
	function updateAllKeys(){
		for(var i = 0; i < keys.length; i++){
			keys[i].update();
		}
	}

	function main(){
		gamestate = new LoadingGamestate();
		
		for(var k in images){
			if(images.hasOwnProperty(k))
				gamestate.need++;
		}
		for(var k in music){
			if(music.hasOwnProperty(k))
				gamestate.need++;
		}
		
		images.frame.onload = function(){ gamestate.loaded++; };
		images.life.onload = function(){ gamestate.loaded++; };
		images.weapons.onload = function(){ gamestate.loaded++; };
		images.room1.onload = function(){ gamestate.loaded++; };
		images.kim.onload = function(){ gamestate.loaded++; };
		images.enemies.onload = function(){ gamestate.loaded++; };
		images.room2.onload = function(){ gamestate.loaded++; };
		images.frame.src = "Images/Frame.png";
		images.life.src = "Images/Life.png";
		images.weapons.src = "Images/Weapons.png";
		images.room1.src = "Images/Room1.png";
		images.kim.src = "Images/Kim.png";
		images.enemies.src = "Images/Enemies.png";
		images.room2.src = "Images/Room2.png";
		music.intro = new Howl({
			onload: function(){ gamestate.loaded++; },
			urls: ['SadSong.wav'],
			});
		
		//This is to help with image smoothing (which looks like crap)
		ctx.mozImageSmoothingEnabled = false;
		ctx.webkitImageSmoothingEnabled = false;
		ctx.msImageSmoothingEnabled = false;
		ctx.imageSmoothingEnabled = false;
		
		document.addEventListener('keydown', handleKeyDown);
		document.addEventListener('keyup', handleKeyUp);
		player = new Player();
		window.requestAnimationFrame(tick);
	}

	main();
	
	
	/*
	Things to work on:
		when we finish, you can take a
	*/
	</script>
</html>